<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Smart Notes - Files</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
:root{
  --bg:#1a0d05;
  --card:#2b170a;
  --text:gold;
  --border:gold;
}
.light{
  --bg:#e0f7fa;
  --card:#e0e0e0;
  --text:#000;
  --border:#444;
}
body{
  margin:0;
  font-family:Arial;
  background:var(--bg);
  color:var(--text);
}
header{
  display:flex;
  justify-content:space-between;
  padding:10px;
  box-shadow:0 0 10px var(--border);
}
button,input{
  border:1px solid var(--border);
  background:transparent;
  color:var(--text);
  padding:6px;
  border-radius:6px;
}
.card{
  background:var(--card);
  margin:10px;
  padding:10px;
  border-radius:10px;
  box-shadow:0 0 10px rgba(0,0,0,0.3);
}
.fileItem{
  padding:6px;
  border-bottom:1px solid var(--border);
  cursor:pointer;
}
</style>
</head>

<body>

<header>
<h2>ğŸ“ Smart Notes - Files</h2>
<div>
<button onclick="toggleTheme()">ğŸŒ™ / â˜€ï¸</button>
<button onclick="location.href='index.html'">ğŸ  Home</button>
</div>
</header>

<div class="card">
<input type="file" id="fileInput">
<button onclick="saveFile()">Upload</button>
</div>

<div class="card">
<h3>Saved Files</h3>
<div id="fileList"></div>
</div>

<script>
function toggleTheme(){
  document.body.classList.toggle("light");
}

let db;
let request = indexedDB.open("SmartNotesFilesDB", 1);

request.onupgradeneeded = function(e){
  db = e.target.result;
  db.createObjectStore("files", { keyPath: "id", autoIncrement: true });
};

request.onsuccess = function(e){
  db = e.target.result;
  loadFiles();
};

function saveFile(){
  let file = document.getElementById("fileInput").files[0];
  if(!file) return alert("Select a file");

  let reader = new FileReader();
  reader.onload = function(){
    let tx = db.transaction("files","readwrite");
    let store = tx.objectStore("files");
    store.add({ name:file.name, data:reader.result });
    tx.oncomplete = ()=>{ alert("File saved"); loadFiles(); };
  };
  reader.readAsDataURL(file);
}

function loadFiles(){
  let list = document.getElementById("fileList");
  list.innerHTML="";
  let tx = db.transaction("files","readonly");
  let store = tx.objectStore("files");

  store.openCursor().onsuccess = function(e){
    let cursor = e.target.result;
    if(cursor){
      let div = document.createElement("div");
      div.className="fileItem";
      div.textContent = cursor.value.name;
      div.onclick = ()=>openFile(cursor.key);
      list.appendChild(div);
      cursor.continue();
    }
  };
}

function openFile(id){
  let tx = db.transaction("files","readonly");
  let store = tx.objectStore("files");
  let req = store.get(id);

  req.onsuccess = function(){
    let f = req.result;
    let a = document.createElement("a");
    a.href = f.data;
    a.download = f.name;
    a.click();
  };
}
</script>

</body>
</html>
